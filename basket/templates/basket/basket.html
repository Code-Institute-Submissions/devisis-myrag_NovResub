{% extends "base.html" %}
{% load static %}
{% load basket_tools %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'basket/css/basket.css' %}">
{% endblock %}

{% block title %}
<title> Myrag - basket </title>
{% endblock %}

{% block page_header %}

{% endblock %}

{% block content %}
<!-- Basket -->
<div class="container-fluid text-center {% if  not basket_durags %} h-100{% endif %} "> 

  <div class="row">
    <div class="col-12">
      <hr>
      <h2>Shopping Basket</h2>
      <hr>
    </div>
  </div>
  <div class="row d-flex justify-content-center py-4">
    <div class="col-xs-5 col-md-8 d-flex justify-content-center">
      {% if basket_durags %}
      <!-- create table to house durags added to basket -->
      <div class="col table-responsive rounded basket-display">
        <table class="table table-striped table-borderless table-sm">
          <thead>
            <tr>
              <th scope="col"></th>
              <th scope="col">Durag</th>
              <th scope="col">Price</th>
              <th scope="col">Quantity</th>
              <th scope="col">Sub Total</th>
            </tr>
          </thead>
          <tbody>
            <!-- for each item in basket to fill out table -->
            {% for durag_info in basket_durags %}
            <tr>
              <td class="">
                <!-- name of durag and image -->
                  {% if durag_info.durag.featured_image %}
                  <img class="rounded img-fluid" style="width: 100px; height: 100px; object-fit: cover;"
                  src="{{ durag_info.durag.featured_image.url }}"
                  alt="{{ durag_info.product.name }}">
                  {% else %}
                  <img class="rounded img-fluid" style="width: 100px; height: 100px; object-fit: cover;"
                  src="{{ MEDIA_URL }}noimage.png"
                  alt="{{ durag_info.product.name }}">
                  {% endif %}
              </td>
              <td>
                <p>{{ durag_info.durag.name }}</p>
              </td>
              <td>
                <!-- durag price -->
                <p>£{{ durag_info.durag.price }}</p>
              </td>

              <td>
                <!-- durag quantity -->
                {% include 'includes/update_form.html' %}
              </td>

              <td>
                <!-- durag sub total -->
                <p>£{{ durag_info.durag.price | calc_sub:durag_info.quantity }}</p>
              </td>
            </tr>
            {% endfor %}
            <tr>
              <td colspan="7" class="text-white">Total Price: £ {{ total }}</td>
            </tr>
          </tbody>
        </table>


        <a href="{% url 'durags' %}" class="btn btn-info mr-4 float-left">
          Keep Looking
        </a>
        <a href="{% url 'checkout' %}" class="btn btn-success ml-4 float-right">
          Secure Checkout
        </a>

      </div>
      {% else %}
      <div class="row">
        <div class="col">
          <p class="bold lead">Your shopping basket is <strong>empty</strong>.</p>
          <a href="{% url 'durags' %}" class="btn btn-outline btn-lg">
            <h4><u>View Durags</u></h4>
          </a>
        </div>
      </div>
      {% endif %}



      <!-- endif -->
    </div>
  </div>
</div>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
{% include 'includes/quantity_input_script.html' %}
<script type="text/javascript">
  // update quantity link
  $('.update-basket').click(function (e) {
    var form = $(this).prev('.update-form');
    form.submit();
  })

  // delete quantity link
  $('.delete-basket').click(function (e) {
    var csrf_token = "{{ csrf_token }}";
    var duragId = $(this).attr('id').split('delete_')[1];
    var url = `/basket/delete/${duragId}/`;
    var data = {
      'csrfmiddlewaretoken': csrf_token
    }

    $.post(url, data)
      .done(function () {
        location.reload();
      });
  })
</script>

{% endblock %}